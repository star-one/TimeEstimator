<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script>
var BackgroundClass = Quill.import('attributors/class/background');
var ColorClass = Quill.import('attributors/class/color');
var SizeStyle = Quill.import('attributors/style/size');
Quill.register(BackgroundClass, true);
Quill.register(ColorClass, true);
Quill.register(SizeStyle, true);
Quill.register("modules/htmlEditButton", htmlEditButton);
  
  var reflections = new Quill('#reflections-container', {
  modules: {
    toolbar: [
      [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
      ['bold', 'italic', 'blockquote', 'link'],
      [{ list: 'bullet' }, { list: 'ordered' }],
      [{ 'indent': '-1'}, { 'indent': '+1' }],
    ],
    htmlEditButton: {
      okText: "Save", 
      msg: "Edit the HTML",
      buttonHTML: "&lt;html&gt;",
    }
  },
  theme: 'snow'
});
</script>
<?php
$ServerPath = $_SERVER['DOCUMENT_ROOT'];
$include = $ServerPath . "/shared/connexion.php";
include_once($include);

$projectID = sanitise(mysqli_real_escape_string($connect, $_REQUEST["projectID"]));
$editProject = sanitise(mysqli_real_escape_string($connect, $_REQUEST["editProject"]));
$workstreamID = sanitise(mysqli_real_escape_string($connect, $_REQUEST["workstreamID"]));
$editWorkstream = sanitise(mysqli_real_escape_string($connect, $_REQUEST["editWorkstream"]));
$taskID = sanitise(mysqli_real_escape_string($connect, $_REQUEST["taskID"]));
$newProject = sanitise(mysqli_real_escape_string($connect, $_REQUEST["newProject"]));
$newWorkstream = sanitise(mysqli_real_escape_string($connect, $_REQUEST["newWorkstream"]));
$newTask = sanitise(mysqli_real_escape_string($connect, $_REQUEST["newTask"]));
$newNote = sanitise(mysqli_real_escape_string($connect, $_REQUEST["newNote"]));
$newLink = sanitise(mysqli_real_escape_string($connect, $_REQUEST["newLink"]));
$estimateTime = sanitise(mysqli_real_escape_string($connect, $_REQUEST["estimateTime"]));
?>
<script>
if(timer) { clearInterval(timer); }
if(timeBoxTimer) { clearInterval(timeBoxTimer); }

function getWorkstreams(id)
{
    var xmlhttp=new XMLHttpRequest();
     xmlhttp.onreadystatechange=function()
	{
    if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
     document.getElementById("workstreamID").innerHTML=xmlhttp.responseText;
     }
 	}
    xmlhttp.open("GET","/getworkstreams.php?projectID="+id,true);
    xmlhttp.send();
}

function getTasks(id)
{
    var xmlhttp=new XMLHttpRequest();
     xmlhttp.onreadystatechange=function()
	{
    if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
     document.getElementById("taskID").innerHTML=xmlhttp.responseText;
     }
 	}
    xmlhttp.open("GET","/gettasks.php?workstreamID="+id,true);
    xmlhttp.send();
}

function timerStart(taskDuration){
    min = document.getElementById('taskDuration').value;
    timer = setInterval(function(){
        min++;
        document.getElementById('taskDuration').value=min;
    }, 60000);
        document.getElementById('timerStarter').style.display = "none";
        document.getElementById('timerPauser').style.display = "inline";
}
function timerPause(){
  clearInterval(timer);
  document.getElementById('timerStarter').style.display = "inline";
  document.getElementById('timerPauser').style.display = "none";
}
function startTimeBox(){
  timeBoxTime = document.getElementById('timeBox').value;
  document.getElementById('theTimeBoxTime').style.display = "inline";
  document.getElementById('theTimeBoxTime').innerHTML=timeBoxTime + " remaining";
        if(timeBoxTime == 'stop')
          {
            clearInterval(timeBoxTimer);
            document.getElementById('theTimeBoxTime').innerHTML= "Timebox stopped";
            return;
          }
     timeBoxTimer = setInterval(function(){
        timeBoxTime--;
        document.getElementById('theTimeBoxTime').innerHTML=timeBoxTime + " remaining";
        if(timeBoxTime == 0)
          {
            speechSynthesis.speak(new SpeechSynthesisUtterance('Your timebox timer is up - have a break and shift to a new task!'));
            document.getElementById('theTimeBoxTime').innerHTML= "Complete!";
            alert('Your timebox timer is up - have a break and shift to a new task!');
            clearInterval(timeBoxTimer);
          }
    }, 60000);
}
</script>
<?php
if($newProject AND $userID)
{
?>
      <h2>
       Add project
      </h2>
      <form name="addprojectform" id="addprojectform" action="/" method="post">
        <label for="projectName" class="form-label">Project name:</label>
        <input type="text" class="form-control" name="projectName" id="projectName" required />
        <label for="projectDescription" class="form-label">Project description:</label><br />
        <textarea name="projectDescription" class="form-control" id="projectDescription"></textarea>
        <label for="projectDeadlineDate" class="form-label">Project deadline date:</label>
        <input type="date" class="form-control" name="projectDeadlineDate" id="projectDeadlineDate" />

        <input type="hidden" name="theForm" value="addProject" />
        <input type="submit" class="btn btn-primary" value="Add project" />
      </form>
<?php
}
?>
<?php
if($projectID AND $editProject AND $userID)
{
      $findDataSQL = $connect->prepare("SELECT * FROM Projects WHERE id = ?");
      $findDataSQL->bind_param("i", $projectID);
      $findDataSQL->execute();
	    $projects = $findDataSQL->get_result();
	    while ($theProject = $projects->fetch_assoc())
	    {
?>
      <h2>
       Edit project
      </h2>
      <form name="editprojectform" id="editprojectform" action="/" method="post">
        <label for="projectName" class="form-label">Project name:</label>
        <input type="text" class="form-control" name="projectName" id="projectName" value="<?php echo $theProject['projectName']; ?>" required />
        <label for="projectDescription" class="form-label">Project description:</label>
        <textarea name="projectDescription" class="form-control" id="projectDescription"><?php echo $theProject['projectDescription']; ?></textarea>
        <label for="projectDeadlineDate" class="form-label">Project deadline date:</label>
        <input type="date" class="form-control" name="projectDeadlineDate" id="projectDeadlineDate" value="<?php echo $theProject['projectDeadlineDate']; ?>" />
        <label for="projectCompletionDate" class="form-label">Project completion date:</label>
        <input type="date" class="form-control" name="projectCompletionDate" id="projectCompletionDate" value="<?php echo $theProject['projectCompletionDate']; ?>" />

        <input type="hidden" name="projectID" value="<?=$projectID; ?>" />
        <input type="hidden" name="theForm" value="editProject" />
        <input type="submit" class="btn btn-primary" value="Update project" />
      </form>
<?php
      }
      $findDataSQL->close();
}
?>

<?php
if($newWorkstream AND $userID)
{
?>
      <h2>
       Add workstream
      </h2>
      <form name="addworkstreamform" id="addworkstreamform" action="/" method="post">
        <label for="projectID" class="form-label">Project:</label>
        <select name="projectID" class="form-control" id="projectID">
       <!-- <option value="0">-- select project --</option> -->
        <?php
          getUserDropDowns('Projects', 'projectName', $projectID, $userID);
        ?>
        </select>
        <label for="workstreamName" class="form-label">Workstream name:</label>
        <input type="text" class="form-control" name="workstreamName" id="workstreamName" required />
        <label for="workstreamDescription" class="form-label">Workstream description:</label>
        <textarea name="workstreamDescription" class="form-control" id="workstreamDescription"></textarea>
        <label for="workstreamDeadlineDate" class="form-label">Workstream deadline date:</label>
        <input type="date" class="form-control" name="workstreamDeadlineDate" id="workstreamDeadlineDate" />

        <input type="hidden" name="theForm" value="addWorkstream" />
        <input type="submit" class="btn btn-primary" value="Add workstream" />
      </form>
<?php
}
?>
<?php
if($workstreamID AND $editWorkstream AND $userID)
{
      $findDataSQL = $connect->prepare("SELECT * FROM Workstreams WHERE id = ?");
      $findDataSQL->bind_param("i", $workstreamID);
      $findDataSQL->execute();
	    $workstreams = $findDataSQL->get_result();
	    while ($theWorkstream = $workstreams->fetch_assoc())
	    {
?>
      <h2>
       Edit workstream
      </h2>
      <form name="editworkstreamform" id="editworkstreamform" action="/" method="post">
        <label for="projectID" class="form-label">Project:</label>
        <select name="projectID" class="form-control" id="projectID">
        <option value="0">-- select project --</option>
        <?php
          getUserDropDowns('Projects', 'projectName', $theWorkstream['projectID'], $userID);
        ?>
        </select>
        <label for="workstreamName" class="form-label">Workstream name:</label>
        <input type="text" class="form-control" name="workstreamName" id="workstreamName" value="<?=unescapeToPlain($theWorkstream['workstreamName']);?>" required />
        <label for="workstreamDescription" class="form-label">Workstream description:</label>
        <textarea name="workstreamDescription" class="form-control" id="workstreamDescription"><?=unescapeToPlain($theWorkstream['workstreamDescription']);?></textarea>
        <label for="workstreamDeadlineDate" class="form-label">Workstream deadline date:</label>
        <input type="date" class="form-control" name="workstreamDeadlineDate" id="workstreamDeadlineDate" value="<?=$theWorkstream['workstreamDeadlineDate'];?>" />
        <label for="workstreamCompletionDate" class="form-label">Workstream completion date:</label>
        <input type="date" class="form-control" name="workstreamCompletionDate" id="workstreamCompletionDate" value="<?=$theWorkstream['workstreamCompletionDate'];?>" />

        <input type="hidden" name="workstreamID" value="<?=$workstreamID; ?>" />
        <input type="hidden" name="theForm" value="editWorkstream" />
        <input type="submit" class="btn btn-primary" value="Update workstream" />
      </form>
<?php
      }
      $findDataSQL->close();
}
?>

<?php
if($taskID AND $userID)
{
      $findDataSQL = $connect->prepare("SELECT * FROM Tasks WHERE id = ?");
      $findDataSQL->bind_param("i", $taskID);
      $findDataSQL->execute();
	    $tasks = $findDataSQL->get_result();
	    while ($theTask = $tasks->fetch_assoc())
	    {
?>
      <form name="edittaskform" id="edittaskformform" action="/" method="post">
        <label for="projectID" class="form-label">Project:</label>
        <select name="projectID" class="form-control" id="projectID" onchange="getWorkstreams(this.value)">
        <option value="0">-- select project --</option>
        <?php
          $findData2SQL = $connect->prepare("SELECT * FROM Workstreams WHERE id = ?");
          $findData2SQL->bind_param("i", $theTask['workstreamID']);
          $findData2SQL->execute();
          $project = $findData2SQL->get_result();
          while ($theProject = $project->fetch_assoc())
          {
            $projectID = $theProject['projectID'];
          }
          $findData2SQL->close();
          getUserDropDowns('Projects', 'projectName', $projectID, $userID);
        ?>
        </select>
        <label for="workstreamID" class="form-label">Workstream:</label>
        <select name="workstreamID" class="form-control" id="workstreamID">
        <option value="0">-- select workstream --</option>
        <?php
          getUserDropDowns('Workstreams', 'workstreamName', $theTask['workstreamID'], $userID);
        ?>
        </select>
        <label for="taskName" class="form-label">Task name:</label>
        <input type="text" class="form-control" name="taskName" id="taskName" value="<?=$theTask['taskName'];?>" required />
        <label for="taskDescription" class="form-label">Task description:</label>
        <textarea name="taskDescription" class="form-control" id="taskDescription"><?=unescape($theTask['taskDescription']);?></textarea>
        <label for="taskPriority" class="form-label">Task progression:</label>
        <select name="taskPriority" class="form-control" id="taskPriority">
        <option value="4"<?php if($theTask['taskPriority'] == 4) { echo " selected=\"selected\""; } ?>>Ongoing</option>
        <option value="3"<?php if($theTask['taskPriority'] == 3) { echo " selected=\"selected\""; } ?>>Now</option>
        <option value="2"<?php if($theTask['taskPriority'] == 2) { echo " selected=\"selected\""; } ?>>Next</option>
        <option value="1"<?php if($theTask['taskPriority'] == 1) { echo " selected=\"selected\""; } ?>>Later</option>
        <option value="0"<?php if($theTask['taskPriority'] == 0) { echo " selected=\"selected\""; } ?>>**** ON HOLD ****</option>
        <option value="-1"<?php if($theTask['taskPriority'] == -1) { echo " selected=\"selected\""; } ?>>**** DELETE ****</option>
        </select>
        <label for="taskType" class="form-label">Task type:</label>
        <select name="taskType" class="form-control" id="taskType">
        <option value="0"<?php if($theTask['taskType'] == 0) { echo " selected=\"selected\""; } ?>>Other</option>
        <option value="1"<?php if($theTask['taskType'] == 1) { echo " selected=\"selected\""; } ?>>Active production</option>
        <option value="2"<?php if($theTask['taskType'] == 2) { echo " selected=\"selected\""; } ?>>Informal chat</option>
        <option value="3"<?php if($theTask['taskType'] == 3) { echo " selected=\"selected\""; } ?>>Meeting</option>
        <option value="5"<?php if($theTask['taskType'] == 5) { echo " selected=\"selected\""; } ?>>Research</option>
        <option value="4"<?php if($theTask['taskType'] == 4) { echo " selected=\"selected\""; } ?>>Support</option>
        </select>
        <label for="taskDeadlineDate" class="form-label">Task deadline date:</label>
        <input type="date" class="form-control" name="taskDeadlineDate" id="taskDeadlineDate" value="<?=$theTask['taskDeadlineDate'];?>"/>
        <label for="taskStartDate" class="form-label">Task start date:</label>
        <input type="date" class="form-control" name="taskStartDate" id="taskStartDate" value="<?=$theTask['taskStartDate'];?>"/>
        <label for="taskCompletionDate" class="form-label">Task completion date:</label>
        <input type="date" class="form-control" name="taskCompletionDate" id="taskCompletionDate" value="<?=$theTask['taskCompletionDate'];?>"/>
        <label for="taskDuration" class="form-label">Task duration:</label>
        <input type="number" class="form-control" name="taskDuration" id="taskDuration" class="" value="<?=$theTask['taskDuration'];?>" />
        <?php
        if($theTask['taskDuration'])
        {
        ?>
	      <button type="button" id="timerStarter" style="display: inline;" class='btn btn-info' onClick="timerStart()">Resume timer</button>
        <?php
        }
        else
        {
        ?>
	      <button type="button" id="timerStarter" style="display: inline;" class='btn btn-info' onClick="timerStart()">Start timer</button>
        <?php
        }
        ?>
        <button type="button" id="timerPauser" style="display: none;" class='btn btn-success' onClick="timerPause()"><span class="spinner-grow spinner-grow-sm"></span> Pause timer</button>

        <input type="hidden" name="taskID" value="<?=$taskID; ?>" />
        <input type="hidden" name="theForm" value="editTask" />
        <input type="submit" class="btn btn-primary" value="Update task" /><br />
        
        <label for="timeBox" class="form-label">Timebox:</label><br />
        <select name="timeBox" class="form-control timebox" id="timeBox" onchange="startTimeBox()">
          <option value="">Start a timebox</option>
          <option value="25">25 minutes</option>
          <option value="40">40 minutes</option>
          <option value="55">55 minutes</option>
          <option value="85">85 minutes</option>
          <option value="stop">Stop the timebox</option>
        </select>
        <span type="number" class="timeboxtime" name="theTimeBoxTime" id="theTimeBoxTime"></span>
      </form>
<?php
	    }
      $findDataSQL->close();
}
?>
<?php
if($newTask AND $userID)
{
?>
      <h2>
        Add task
      </h2>
      <form name="addtaskform" id="addtaskformform" action="." method="post">
        <label for="projectID" class="form-label">Project:</label>
        <select name="projectID" class="form-control" id="projectID" onchange="getWorkstreams(this.value)">
        <option value="0">-- select project --</option>
        <?php
          getUserDropDowns('Projects', 'projectName', 0, $userID);
        ?>
        </select>
        <label for="workstreamID" class="form-label">Workstream:</label>
        <select name="workstreamID" class="form-control" id="workstreamID">
        <!-- <option value="0">-- select workstream --</option> -->
        <?php
          getUserDropDowns('Workstreams', 'workstreamName', $workstreamID, $userID);
        ?>
        </select>
        <label for="taskName" class="form-label">Task name:</label>
        <input type="text" class="form-control" name="taskName" id="taskName" required />
        <label for="taskDescription" class="form-label">Task description:</label>
        <textarea name="taskDescription" class="form-control" id="taskDescription"></textarea>
        <label for="taskPriority" class="form-label">Task progression:</label>
        <select name="taskPriority" class="form-control" id="taskPriority">
        <option value="4">Ongoing</option>
        <option value="3">Now</option>
        <option value="2" selected="selected">Next</option>
        <option value="1">Later</option>
        </select>
         <label for="taskPriority" class="form-label">Task type:</label>
        <select name="taskType" class="form-control" id="taskType">
        <option value="0">Other</option>
        <option value="1">Active production</option>
        <option value="2">Informal chat</option>
        <option value="3">Meeting</option>
        <option value="5">Research</option>
       <option value="4">Support</option>
         </select>
       <label for="taskDeadlineDate" class="form-label">Task deadline date:</label>
        <input type="date" class="form-control" name="taskDeadlineDate" id="taskDeadlineDate" />
        <label for="taskDuration" class="form-label">Task duration:</label>
        <input type="number" class="form-control" name="taskDuration" id="taskDuration" class="" value="0" />
	      <button type="button" id="timerStarter" style="display: inline;" class='btn btn-info' onClick="timerStart(0)">Start timer</button>
         <button type="button" id="timerPauser" style="display: none;" class='btn btn-success' onClick="timerPause()"><span class="spinner-grow spinner-grow-sm"></span> Pause timer</button>

        <input type="hidden" name="theForm" value="addTask" />
        <input type="submit" class="btn btn-primary" value="Add task" /> <input type="checkbox" id="coc" name="coc" value="coc" /> <label for="coc">(Close on creation)</label><br/ >
        
        <label for="timeBox" class="form-label">Timebox:</label><br />
        <select name="timeBox" class="form-control timebox" id="timeBox" onchange="startTimeBox()">
          <option value="">Start a timebox</option>
          <option value="25">25 minutes</option>
          <option value="40">40 minutes</option>
          <option value="55">55 minutes</option>
          <option value="85">85 minutes</option>
          <option value="stop">Stop the timebox</option>
        </select>
        <span type="number" class="timeboxtime" name="theTimeBoxTime" id="theTimeBoxTime"></span>
      </form>
<?php
}
?>
<?php
if($newNote AND $userID)
{
?>
      <h2>
        Add Note
      </h2>
      <form name="addnoteform" id="addnoteformform" action="." method="post">
        <label for="projectID" class="form-label">Project:</label>
        <select name="projectID" class="form-control" id="projectID" onchange="getWorkstreams(this.value)">
        <option value="0">-- General or select project --</option>
        <?php
          getUserDropDowns('Projects', 'projectName', $projectID, $userID);
        ?>
        </select>
        <label for="workstreamID" class="form-label">Workstream:</label>
        <select name="workstreamID" class="form-control" id="workstreamID" onchange="getTasks(this.value)">
        <option value="0">-- General or select workstream --</option>
        <?php
          getUserDropDowns('Workstreams', 'workstreamName', $workstreamID, $userID);
        ?>
        </select>
        <label for="taskID" class="form-label">Task:</label>
        <select name="taskID" class="form-control" id="taskID">
        <option value="0">-- General or select task --</option>
        <?php
          getParentDropDowns('Tasks', 'taskName', 'workstreamID', $workstreamID);
        ?>
        </select>
        <label for="noteDate" class="form-label">Date:</label>
        <input type="date" class="form-control" name="noteDate" id="noteDate" value="<?php echo date("Y-m-d"); ?>" />
        <label for="noteAchievements" class="form-label">Achievements:</label>
        <textarea name="noteAchievements" class="form-control" id="noteAchievements"></textarea>
        <label for="noteObstructions" class="form-label">Obstructions:</label>
        <textarea name="noteObstructions" class="form-control" id="noteObstructions"></textarea>
        <label for="noteReflections" class="form-label">Private Reflections:</label>
        <div id="reflections-container"></div>
        <textarea style="display:none;" name="noteReflections" class="form-control" id="noteReflections"></textarea>
        <label for="noteConfirmation" class="form-label">Tick to confirm you're done</label>
        <input type="checkbox" id="noteConfirmation" name="noteConfirmation" required /><br />

        <input type="hidden" name="theForm" value="addNote" />
        <input type="submit" class="btn btn-primary" value="Add note" />        
     </form>
<?php
}
?>
<?php
if($newLink AND $userID)
{
?>
      <h2>
        Add Link
      </h2>
      <form name="addlinkform" id="addlinkformform" action="." method="post">
        <label for="projectID" class="form-label">Project:</label>
        <select name="projectID" class="form-control" id="projectID" onchange="getWorkstreams(this.value)">
        <option value="0">-- General or select project --</option>
        <?php
          getUserDropDowns('Projects', 'projectName', $projectID, $userID);
        ?>
        </select>
        <label for="workstreamID" class="form-label">Workstream:</label>
        <select name="workstreamID" class="form-control" id="workstreamID" onchange="getTasks(this.value)">
        <option value="0">-- General or select workstream --</option>
        <?php
          getUserDropDowns('Workstreams', 'workstreamName', $workstreamID, $userID);
        ?>
        </select>
        <label for="taskID" class="form-label">Task:</label>
        <select name="taskID" class="form-control" id="taskID">
        <option value="0">-- General or select task --</option>
        <?php
          getParentDropDowns('Tasks', 'taskName', 'workstreamID', $workstreamID);
        ?>
        </select>
        <label for="linkName" class="form-label">Link name:</label>
        <input type="text" class="form-control" name="linkName" id="linkName" required />
        <label for="linkURL" class="form-label">Link URL:</label>
        <input type="text" class="form-control" name="linkURL" id="linkURL" required />

        <input type="hidden" name="theForm" value="addLink" />
        <input type="submit" class="btn btn-primary" value="Add link" />        
     </form>
<?php
}
?>
<?php
if($estimateTime AND $userID)
{
?>
      <h2>
        Estimate time
      </h2>
      <form name="estimatetimeform" id="estimatetimeform" action="." method="post">
        <label for="sampleTime" class="form-label">Sample time (minutes):</label>
        <input type="number" class="form-control" name="sampleTime" id="sampleTime" onKeyUp="javascript:updateTime();" />
        <label for="multiplier" class="form-label">Multiplier:</label>
        <input type="number" class="form-control" name="multiplier" id="multiplier" value="1" onKeyUp="javascript:updateTime();" required />
        <label for="numberOfPeople" class="form-label">Number of people:</label>
        <input type="number" class="form-control" name="numberOfPeople" id="numberOfPeople" value="1" onKeyUp="javascript:updateTime();" required />
        <label for="percentageUtilisation" class="form-label">Percentage utilisation:</label>
        <input type="number" class="form-control" name="percentageUtilisation" id="percentageUtilisation" value="50" onKeyUp="javascript:updateTime();" required />
        <label for="billableProductionTime" class="form-label">Total billable hours:</label>
        <span id="billableProductionTime">0 hours 0 minutes</span><br />
        <label for="realProductionTime" class="form-label">Actual production time:</label>
        <span id="realProductionTime">0 hours 0 minutes</span><br />
        <label for="absoluteProductionTime" class="form-label">Absolute time:</label>
        <span id="absoluteProductionTime">0 days 0 hours 0 minutes</span><br />
        <label for="elapsedProductionTime" class="form-label">Elapsed time:</label>
        <span id="elapsedProductionTime">0 working days</span>
      </form>
      <script>
        function calculateWorkingDays(totalDays) {
          // This function is a blunt instrument. I'll do it more stylishly in due course
          actualDays = 0;
          workingDays = 0;

          while (workingDays < totalDays) {
            actualDays++;
            // Check if the current day is a working day (Monday to Friday)
            if (actualDays % 7 !== 6 && actualDays % 7 !== 0) {
                workingDays++;
            }
            if(actualDays > 365) { return "Far too many"; }
          }
          actualDays++;
          return actualDays;
        }
        function billableConvert(minutes) {
          return `${Math.floor(minutes / 60)} hours ${Math.floor(minutes % 60)} minutes`;
        }
        function daysConvert(minutes) {
          return `${Math.floor(minutes / 7 / 60)} days ${Math.floor((minutes / 60) % 7)} hours ${Math.floor(minutes % 60)} minutes`;
        }
        function elapsedTimeConvert(minutes) {
          // There are 7 hours in a working day - change this to suit your preferences
          return `${calculateWorkingDays(Math.floor(minutes / 7 / 60))} days`;
        }

        function updateTime()
        {
          sampleTime = document.getElementById('sampleTime').value;
          multiplier = document.getElementById('multiplier').value;
          numberOfPeople = document.getElementById('numberOfPeople').value;
          percentageUtilisation = document.getElementById('percentageUtilisation').value;
          
          totalProductionTime = Math.round(((sampleTime * multiplier) / numberOfPeople));
          realProductionTime = Math.round(totalProductionTime / (percentageUtilisation / 100));
          document.getElementById("billableProductionTime").innerHTML = billableConvert(totalProductionTime);
          document.getElementById("realProductionTime").innerHTML = billableConvert(realProductionTime);
          document.getElementById("absoluteProductionTime").innerHTML = daysConvert(realProductionTime);
          document.getElementById("elapsedProductionTime").innerHTML = elapsedTimeConvert(realProductionTime);
        }
      </script>
<?php
}
?>
<!-- Initialize Quill editor -->
<script>
        reflections.on('text-change', function(delta, oldDelta, source) {
            document.getElementById("noteReflections").innerHTML = reflections.container.firstChild.innerHTML;
        });
</script>
